<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä¸è¦å‰‡å‹•è©ã‚¯ã‚¤ã‚ºï¼ˆ2æ¬„ï¼šéå»å½¢ãƒ»éå»åˆ†è©ï¼‰</title>
  <style>
    :root { font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; }
    body { margin: 0; background:#f6f7f9; color:#111; }
    .wrap { max-width: 860px; margin: 0 auto; padding: 20px; }
    .card { background:#fff; border-radius:16px; box-shadow: 0 8px 24px rgba(0,0,0,.08); padding: 18px; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .muted { color:#666; font-size: 13px; }
    .progress { height: 10px; background:#e8eaee; border-radius:999px; overflow:hidden; }
    .bar { height: 100%; width:0%; background:#111; transition: width .25s ease; }

    .questionBox { margin-top: 12px; padding: 14px; border: 1px solid #e6e9f0; border-radius: 14px; background:#fbfcff; }
    .qline { display:flex; gap:10px; flex-wrap:wrap; align-items:baseline; }
    .tag { font-size: 12px; color:#555; background:#eef1f6; padding: 2px 8px; border-radius: 999px; }
    .big { font-size: 22px; font-weight: 800; letter-spacing: .2px; }
    .bigcode { font-size: 22px; font-weight: 800; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }

    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
    @media (max-width: 640px) { .grid2 { grid-template-columns: 1fr; } }

    label { font-size: 13px; color:#444; display:block; }
    input[type="text"] {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid #cfd5df;
      font-size: 16px;
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
    }
    input[type="text"]:focus { outline: none; border-color:#111; box-shadow: 0 0 0 3px rgba(0,0,0,.08); }

    button { border: 0; border-radius: 12px; padding: 11px 14px; font-size: 14px; cursor: pointer; }
    .primary { background:#111; color:#fff; }
    .ghost { background:#eef1f6; color:#111; }
    .danger { background:#ffe6e6; color:#900; }

    .feedback { margin-top: 12px; padding: 12px; border-radius: 12px; background:#f3f4f6; font-size: 14px; }
    .ok { background:#eaffea; }
    .ng { background:#ffecec; }

    details { background:#fff; border-radius: 12px; padding: 10px 12px; border: 1px solid #e4e7ee; }
    summary { cursor:pointer; font-weight: 600; }
    .small { font-size: 12px; color:#555; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background:#f1f3f7; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="screen-start">
      <h1>ä¸è¦å‰‡å‹•è©ã‚¯ã‚¤ã‚ºï¼ˆéå»å½¢ãƒ»éå»åˆ†è©ï¼š2æ¬„ï¼‰</h1>
      <p class="muted">
        è¡¨ç¤ºã•ã‚Œã‚‹ <span class="kbd">æ„å‘³</span> ã¨ <span class="kbd">åŸå½¢</span> ã‚’è¦‹ã¦ã€
        <span class="kbd">éå»å½¢</span> ã¨ <span class="kbd">éå»åˆ†è©</span> ã‚’ãã‚Œãã‚Œå…¥åŠ›ã—ã¾ã™ï¼ˆ50å•ãƒ©ãƒ³ãƒ€ãƒ 1å‘¨ï¼‰ã€‚
        <br>Enterã§ã€Œéå»å½¢â†’éå»åˆ†è©â†’å›ç­”ã€ã®é †ã«é€²ã‚ã¾ã™ã€‚
      </p>
      <div class="row" style="margin-top:14px;">
        <button class="primary" id="btn-start">ã¯ã˜ã‚ã‚‹</button>
      </div>
    </div>

    <div class="card" id="screen-quiz" style="display:none;">
      <div class="row" style="justify-content:space-between;">
        <div><span style="font-weight:800;" id="qno">1</span> / <span id="qtotal">50</span></div>
        <div class="muted">
          éå»å½¢ï¼š<span id="scorePast">0</span> /
          éå»åˆ†è©ï¼š<span id="scorePP">0</span> /
          ä¸¡æ–¹ï¼š<span id="scoreBoth">0</span>
        </div>
      </div>
      <div class="progress" style="margin-top:10px;">
        <div class="bar" id="bar"></div>
      </div>

      <div class="questionBox">
        <div class="qline">
          <span class="tag">æ„å‘³</span>
          <span class="big" id="meaning"></span>
        </div>
        <div class="qline" style="margin-top:6px;">
          <span class="tag">åŸå½¢</span>
          <span class="bigcode" id="base"></span>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label for="pastInput">éå»å½¢ï¼ˆPastï¼‰</label>
          <input id="pastInput" type="text" autocomplete="off" placeholder="ä¾‹ï¼šwent" />
        </div>
        <div>
          <label for="ppInput">éå»åˆ†è©ï¼ˆPast Participleï¼‰</label>
          <input id="ppInput" type="text" autocomplete="off" placeholder="ä¾‹ï¼šgone" />
        </div>
      </div>

      <div class="row" style="margin-top: 10px;">
        <button class="primary" id="btn-submit">å›ç­”ã™ã‚‹</button>
        <button class="ghost" id="btn-skip" title="æœªå…¥åŠ›ã§ã‚‚æ¬¡ã¸ï¼ˆä¸æ­£è§£æ‰±ã„ï¼‰">ã‚¹ã‚­ãƒƒãƒ—</button>
        <button class="danger" id="btn-reset" title="æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>

      <div class="feedback" id="feedback" style="display:none;"></div>
    </div>

    <div class="card" id="screen-result" style="display:none;">
      <h1>çµæœ</h1>
      <p style="font-size:18px; margin: 10px 0;">
        <strong id="finalScore"></strong>
      </p>
      <p class="muted" id="finalMeta"></p>

      <div class="row" style="margin-top:12px;">
        <button class="primary" id="btn-retry">ã‚‚ã†ä¸€åº¦ï¼ˆå†ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼‰</button>
        <button class="ghost" id="btn-review">è§£ç­”ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º</button>
      </div>

      <div style="margin-top:12px;" id="review" style="display:none;"></div>
    </div>
  </div>

<script>
/** â–¼è¡¨ç¤ºæ™‚é–“ï¼ˆmsï¼‰ã“ã“ã ã‘èª¿æ•´ã™ã‚Œã°OK */
const NEXT_DELAY_BOTH_CORRECT = 1000; // éå»å½¢&éå»åˆ†è© ä¸¡æ–¹æ­£è§£
const NEXT_DELAY_ANY_WRONG    = 2200; // ã©ã¡ã‚‰ã‹é–“é•ã„
const RESULT_DELAY = 450;             // æœ€çµ‚å•é¡Œâ†’çµæœã¸

const QUESTIONS = [
  { meaning:"ï½ã«ãªã‚‹", base:"become", past:["became"], pp:["become"] },
  { meaning:"å§‹ã‚ã‚‹", base:"begin", past:["began"], pp:["begun"] },
  { meaning:"ã“ã‚ã™", base:"break", past:["broke"], pp:["broken"] },
  { meaning:"æŒã£ã¦ãã‚‹", base:"bring", past:["brought"], pp:["brought"] },
  { meaning:"å»ºã¦ã‚‹", base:"build", past:["built"], pp:["built"] },
  { meaning:"è²·ã†", base:"buy", past:["bought"], pp:["bought"] },
  { meaning:"ã¤ã‹ã¾ãˆã‚‹", base:"catch", past:["caught"], pp:["caught"] },
  { meaning:"æ¥ã‚‹", base:"come", past:["came"], pp:["come"] },
  { meaning:"ã™ã‚‹", base:"do", past:["did"], pp:["done"] },
  { meaning:"é£²ã‚€", base:"drink", past:["drank"], pp:["drunk"] },
  { meaning:"é‹è»¢ã™ã‚‹", base:"drive", past:["drove"], pp:["driven"] },
  { meaning:"é£Ÿã¹ã‚‹", base:"eat", past:["ate"], pp:["eaten"] },
  { meaning:"è½ã¡ã‚‹", base:"fall", past:["fell"], pp:["fallen"] },
  { meaning:"æ„Ÿã˜ã‚‹", base:"feel", past:["felt"], pp:["felt"] },
  { meaning:"è¦‹ã¤ã‘ã‚‹", base:"find", past:["found"], pp:["found"] },
  { meaning:"é£›ã¶", base:"fly", past:["flew"], pp:["flown"] },
  { meaning:"å¿˜ã‚Œã‚‹", base:"forget", past:["forgot"], pp:["forgot","forgotten"] },
  { meaning:"å¾—ã‚‹", base:"get", past:["got"], pp:["got","gotten"] },
  { meaning:"ä¸ãˆã‚‹", base:"give", past:["gave"], pp:["given"] },
  { meaning:"è¡Œã", base:"go", past:["went"], pp:["gone"] },
  { meaning:"ã‚‚ã£ã¦ã„ã‚‹", base:"have", past:["had"], pp:["had"] },
  { meaning:"é–“ã", base:"hear", past:["heard"], pp:["heard"] },
  { meaning:"æ‰“ã¤", base:"hit", past:["hit"], pp:["hit"] },
  { meaning:"æŠ±ã", base:"hold", past:["held"], pp:["held"] },
  { meaning:"ï¼ˆçŠ¶æ…‹ã®ï¼‰ã¾ã¾ã¦ã„ã‚‹", base:"keep", past:["kept"], pp:["kept"] },
  { meaning:"çŸ¥ã£ã¦ã„ã‚‹", base:"know", past:["knew"], pp:["known"] },
  { meaning:"å‡ºç™ºã™ã‚‹", base:"leave", past:["left"], pp:["left"] },
  { meaning:"å¤±ã†", base:"lose", past:["lost"], pp:["lost"] },
  { meaning:"ã¤ãã‚‹", base:"make", past:["made"], pp:["made"] },
  { meaning:"ä¼šã†", base:"meet", past:["met"], pp:["met"] },
  { meaning:"ç½®ã", base:"put", past:["put"], pp:["put"] },
  { meaning:"èª­ã‚€", base:"read", past:["read"], pp:["read"] },
  { meaning:"èµ°ã‚‹", base:"run", past:["ran"], pp:["run"] },
  { meaning:"è¨€ã†", base:"say", past:["said"], pp:["said"] },
  { meaning:"è¦‹ã‚‹", base:"see", past:["saw"], pp:["seen"] },
  { meaning:"å£²ã‚‹", base:"sell", past:["sold"], pp:["sold"] },
  { meaning:"é€ã‚‹", base:"send", past:["sent"], pp:["sent"] },
  { meaning:"è¦‹ã›ã‚‹", base:"show", past:["showed"], pp:["shown"] },
  { meaning:"æ­Œã†", base:"sing", past:["sang"], pp:["sung"] },
  { meaning:"çœ ã‚‹", base:"sleep", past:["slept"], pp:["slept"] },
  { meaning:"è©±ã™", base:"speak", past:["spoke"], pp:["spoken"] },
  { meaning:"ç«‹ã£ã¦ã„ã‚‹", base:"stand", past:["stood"], pp:["stood"] },
  { meaning:"æ³³ã", base:"swim", past:["swam"], pp:["swum"] },
  { meaning:"æŒã£ã¦ã„ã", base:"take", past:["took"], pp:["taken"] },
  { meaning:"æ•™ãˆã‚‹", base:"teach", past:["taught"], pp:["taught"] },
  { meaning:"è©±ã™", base:"tell", past:["told"], pp:["told"] },
  { meaning:"æ€ã†", base:"think", past:["thought"], pp:["thought"] },
  { meaning:"å‹ã¤", base:"win", past:["won"], pp:["won"] },
  { meaning:"ç†è§£ã™ã‚‹", base:"understand", past:["understood"], pp:["understood"] },
  { meaning:"æ›¸ã", base:"write", past:["wrote"], pp:["written"] },
];

const TOTAL = QUESTIONS.length;
const el = (id) => document.getElementById(id);

function showScreen(name) {
  el("screen-start").style.display = name === "start" ? "" : "none";
  el("screen-quiz").style.display = name === "quiz" ? "" : "none";
  el("screen-result").style.display = name === "result" ? "" : "none";
}

function shuffle(array) {
  const a = array.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/** è‹±èªå›ç­”å‘ã‘ */
function normalize(str) {
  if (str == null) return "";
  let s = String(str).trim();
  s = s.replace(/[ \u3000\t\r\n]+/g, "");
  s = s.toLowerCase();
  s = s.replace(/[ï¼Œ,ã€‚ï¼.ãƒ»ï½¥ï¼š:;ï¼/ï¼ˆï¼‰()ï¼»\[\]ï¼½ã€ã€‘ã€ã€ã€Œã€"â€œâ€'â€™\-ãƒ¼â€•â€”â€“]/g, "");
  return s;
}
function isCorrect(userInput, answers) {
  const u = normalize(userInput);
  const pool = answers.map(normalize);
  return pool.includes(u);
}
function escapeHtml(s) {
  return String(s)
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}

// --- State ---
let order = [];
let idx = 0;
let scorePast = 0;
let scorePP = 0;
let scoreBoth = 0;
let startedAt = null;
let log = [];

function start() {
  order = shuffle(QUESTIONS.map((_, i) => i));
  idx = 0;
  scorePast = 0;
  scorePP = 0;
  scoreBoth = 0;
  startedAt = Date.now();
  log = [];

  el("qtotal").textContent = String(TOTAL);
  el("scorePast").textContent = "0";
  el("scorePP").textContent = "0";
  el("scoreBoth").textContent = "0";
  el("feedback").style.display = "none";

  showScreen("quiz");
  render();
  el("pastInput").focus();
}

function render() {
  const total = order.length;
  const qIndex = order[idx];
  const item = QUESTIONS[qIndex];

  el("qno").textContent = String(idx + 1);
  el("meaning").textContent = item.meaning;
  el("base").textContent = item.base;

  el("pastInput").value = "";
  el("ppInput").value = "";
  el("feedback").style.display = "none";
  el("bar").style.width = Math.round((idx / total) * 100) + "%";
}

function submit(isSkip=false) {
  const total = order.length;
  const qIndex = order[idx];
  const item = QUESTIONS[qIndex];

  const userPast = isSkip ? "" : el("pastInput").value;
  const userPP   = isSkip ? "" : el("ppInput").value;

  const pastOK = isSkip ? false : isCorrect(userPast, item.past);
  const ppOK   = isSkip ? false : isCorrect(userPP, item.pp);

  if (pastOK) scorePast++;
  if (ppOK) scorePP++;
  if (pastOK && ppOK) scoreBoth++;

  el("scorePast").textContent = String(scorePast);
  el("scorePP").textContent = String(scorePP);
  el("scoreBoth").textContent = String(scoreBoth);

  log.push({
    meaning: item.meaning,
    base: item.base,
    userPast, userPP,
    pastOK, ppOK,
    pastAns: item.past.slice(),
    ppAns: item.pp.slice()
  });

  const fb = el("feedback");
  fb.style.display = "";
  fb.className = "feedback " + ((pastOK && ppOK) ? "ok" : "ng");

  fb.innerHTML =
    (pastOK ? `âœ… éå»å½¢ï¼šæ­£è§£` : `âŒ éå»å½¢ï¼šæ­£è§£ã¯ <strong>${escapeHtml(item.past[0])}</strong>`) +
    (item.past.length > 1 ? `<div class="small">åˆ¥è§£ï¼š${item.past.slice(1).map(escapeHtml).join(" / ")}</div>` : "") +
    `<hr style="border:none;border-top:1px solid rgba(0,0,0,.08); margin:10px 0;">` +
    (ppOK ? `âœ… éå»åˆ†è©ï¼šæ­£è§£` : `âŒ éå»åˆ†è©ï¼šæ­£è§£ã¯ <strong>${escapeHtml(item.pp[0])}</strong>`) +
    (item.pp.length > 1 ? `<div class="small">åˆ¥è§£ï¼š${item.pp.slice(1).map(escapeHtml).join(" / ")}</div>` : "");

  const delay = (pastOK && ppOK) ? NEXT_DELAY_BOTH_CORRECT : NEXT_DELAY_ANY_WRONG;

  if (idx + 1 >= total) {
    el("bar").style.width = "100%";
    setTimeout(showResult, RESULT_DELAY);
  } else {
    setTimeout(next, delay);
  }
}

function next() {
  if (idx + 1 >= order.length) return;
  idx++;
  render();
  el("pastInput").focus();
}

function showResult() {
  const elapsedSec = startedAt ? Math.round((Date.now() - startedAt) / 1000) : 0;
  const pctPast = Math.round((scorePast / TOTAL) * 1000) / 10;
  const pctPP = Math.round((scorePP / TOTAL) * 1000) / 10;
  const pctBoth = Math.round((scoreBoth / TOTAL) * 1000) / 10;

  el("finalScore").textContent =
    `éå»å½¢ï¼š${scorePast}/${TOTAL}ï¼ˆ${pctPast}%ï¼‰ï½œéå»åˆ†è©ï¼š${scorePP}/${TOTAL}ï¼ˆ${pctPP}%ï¼‰ï½œä¸¡æ–¹ï¼š${scoreBoth}/${TOTAL}ï¼ˆ${pctBoth}%ï¼‰`;

  el("finalMeta").textContent =
    `æ‰€è¦æ™‚é–“ï¼š${elapsedSec}ç§’ / é–‹å§‹ï¼š${new Date(startedAt).toLocaleString()} / çµ‚äº†ï¼š${new Date().toLocaleString()}`;

  el("review").style.display = "none";
  el("review").innerHTML = "";
  el("btn-review").textContent = "è§£ç­”ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º";

  showScreen("result");
}

function buildReview() {
  const container = el("review");
  container.innerHTML = "";

  log.forEach((r, i) => {
    const d = document.createElement("details");
    const s = document.createElement("summary");
    const mark = (r.pastOK && r.ppOK) ? "âœ…" : (r.pastOK || r.ppOK) ? "ğŸŸ¨" : "âŒ";
    s.innerHTML = `${i + 1}. ${mark} ${escapeHtml(r.meaning)} / <span class="small">${escapeHtml(r.base)}</span>`;
    d.appendChild(s);

    const div = document.createElement("div");
    div.className = "small";
    div.style.marginTop = "8px";
    div.innerHTML =
      `éå»å½¢ï¼šã‚ãªãŸ <strong>${r.userPast ? escapeHtml(r.userPast) : "ï¼ˆæœªå›ç­”ï¼‰"}</strong> ï¼ æ­£è§£ <strong>${escapeHtml(r.pastAns[0])}</strong>` +
      (r.pastAns.length > 1 ? `ï¼ˆåˆ¥è§£ï¼š${r.pastAns.slice(1).map(escapeHtml).join(" / ")}ï¼‰` : "") +
      `<br>` +
      `éå»åˆ†è©ï¼šã‚ãªãŸ <strong>${r.userPP ? escapeHtml(r.userPP) : "ï¼ˆæœªå›ç­”ï¼‰"}</strong> ï¼ æ­£è§£ <strong>${escapeHtml(r.ppAns[0])}</strong>` +
      (r.ppAns.length > 1 ? `ï¼ˆåˆ¥è§£ï¼š${r.ppAns.slice(1).map(escapeHtml).join(" / ")}ï¼‰` : "");

    d.appendChild(div);
    container.appendChild(d);
  });
}

function resetAll() {
  if (!confirm("ãƒªã‚»ãƒƒãƒˆã—ã¦æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ")) return;
  showScreen("start");
}

// --- Events ---
el("btn-start").addEventListener("click", start);
el("btn-submit").addEventListener("click", () => submit(false));
el("btn-skip").addEventListener("click", () => submit(true));
el("btn-reset").addEventListener("click", resetAll);
el("btn-retry").addEventListener("click", start);
el("btn-review").addEventListener("click", () => {
  const box = el("review");
  if (box.style.display === "none") {
    buildReview();
    box.style.display = "";
    el("btn-review").textContent = "è§£ç­”ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’éš ã™";
  } else {
    box.style.display = "none";
    el("btn-review").textContent = "è§£ç­”ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º";
  }
});

// Enterã§ã€Œéå»å½¢â†’éå»åˆ†è©â†’å›ç­”ã€
document.addEventListener("keydown", (e) => {
  const inQuiz = el("screen-quiz").style.display !== "none";
  if (!inQuiz) return;

  if (e.key === "Enter") {
    e.preventDefault();
    const active = document.activeElement;
    if (active && active.id === "pastInput") {
      el("ppInput").focus();
    } else {
      submit(false);
    }
  }
});
</script>
</body>
</html>
